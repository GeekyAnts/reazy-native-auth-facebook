{"version":3,"sources":["../../../src/generators/add/index.js"],"names":["generators","require","fs","path","assign","getPolyfill","transform","xcode","os","https","extractZip","downloadFile","hostname","downloadPath","filename","cb","options","port","method","headers","file","createWriteStream","req","request","res","on","d","write","error","end","randomString","length","chars","result","i","Math","round","random","useService","statement","fileContents","readFileSync","encoding","split","indexOfApp","filter","word","index","match","splice","join","writeFileSync","importService","name","moduleName","existsSync","content","toString","ast","parse","addImport","print","addGroup","groupName","uuid","fileContentsArr","mainGroupLineNumber","indexOf","mainGroupLineContents","mainGroupId","replace","groupIdLineNumber","editPBXProj","projName","myProj","project","frameworkPaths","parseSync","groupObj","addPbxGroup","addBuildPropertyCustom","writeSync","console","log","editInfoPlist","dictEndLineNumber","addHeaderImport","importStatement","lastImportLineNumber","addStatementInFunc","funcName","funcLineNumber","funcOpenLineNumber","addFuncLast","funcDef","classEndLineNumber","editAppDelegate","linkAndroid","lineNumber","addToEnv","appendFileSync","module","exports","Base","extend","constructor","apply","arguments","initializing","pkg","readJSON","destinationPath","process","exit","props","cwd","sep","pop","prompting","done","async","prompts","message","default","prompt","then","bind","downloading","self","templatePath","dir","err","writing","appJsPath","envPath","iosProjPath","infoPlistPath","appDelegatePath","androidBuildGradlePath","npmInstall","save","spawnCommandSync","copySync","homedir","fbAppId","fbAppName"],"mappings":"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","file":"index.js","sourcesContent":["var generators = require('yeoman-generator');\nvar fs = require('fs-extra');\nvar path = require('path');\nvar assign = require('object.assign').getPolyfill();\nvar transform = require('../../lib/transform');\nvar xcode = require('xcode');\nvar os = require('os');\nvar https = require('https');\nvar extractZip = require('extract-zip');\n\nfunction downloadFile(hostname, downloadPath, filename, cb) {\n\n  var options = {\n    hostname  : hostname,\n    port      : 443,\n    path      : downloadPath,\n    method    : 'GET',\n    headers: {\n      'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36'\n    }\n  };\n\n  var file = fs.createWriteStream(filename);\n\n  var req = https.request(options, function(res) {\n    res.on('data', function(d) {\n      file.write(d);\n    });\n    res.on('end', function() {\n      cb();\n    });\n    res.on('error', function(error) {\n      cb(error);\n    })\n  });\n  req.end();\n}\n\nfunction randomString(length) {\n  var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  var result = '';\n  for (var i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n  return result;\n}\n\nfunction useService(filename, statement) {\n  let fileContents = fs.readFileSync(filename, {encoding: 'utf8'}).split('\\n');\n  let indexOfApp = fileContents.length - 1;\n  fileContents.filter(function (word, index) {\n    if (word.match(/app.use.*\\(.*auth\\(\\)/g)) {\n      indexOfApp = index;\n      return true;\n    }\n    return false;\n  });\n  fileContents.splice(indexOfApp + 1, 0, '');\n  fileContents.splice(indexOfApp + 2, 0, statement);\n  fileContents = fileContents.join('\\n');\n  fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n}\n\nfunction importService(filename, name, moduleName) {\n  if (fs.existsSync(filename)) {\n    var content = fs.readFileSync(filename).toString();\n    var ast = transform.parse(content);\n\n    transform.addImport(ast, name, moduleName);\n\n    fs.writeFileSync(filename, transform.print(ast));\n  }\n}\n\nfunction addGroup(fileContents, groupName, uuid) {\n  let fileContentsArr = fileContents.split('\\n');\n  let mainGroupLineNumber = 0;\n  fileContentsArr.filter(function (word, index) {\n    if (word.indexOf('mainGroup = ') !== -1) {\n      mainGroupLineNumber = index;\n      return true;\n    }\n    return false;\n  });\n\n  const mainGroupLineContents = fileContentsArr[mainGroupLineNumber].split(' ');\n  const mainGroupId = mainGroupLineContents[mainGroupLineContents.length - 1].replace(';', '');\n\n  let groupIdLineNumber = 0;\n  fileContentsArr.filter(function (word, index) {\n    if (word.indexOf(mainGroupId + ' = ') !== -1) {\n      groupIdLineNumber = index;\n      return true;\n    }\n    return false;\n  });\n\n  fileContentsArr.splice(groupIdLineNumber + 3, 0, `${uuid} \\/\\* ${groupName} \\*\\/,`);\n\n  fileContents = fileContentsArr.join('\\n');\n  return fileContents;\n}\n\nfunction editPBXProj(filename, projName) {\n\n  if (fs.existsSync(filename)) {\n\n    var myProj = xcode.project(filename);\n\n    const frameworkPaths = [\n      '~/Documents/FacebookSDK/Bolts.framework',\n      '~/Documents/FacebookSDK/FBSDKCoreKit.framework',\n      '~/Documents/FacebookSDK/FBSDKLoginKit.framework',\n      '~/Documents/FacebookSDK/FBSDKShareKit.framework',\n    ]\n\n    myProj = myProj.parseSync();\n\n    var groupObj = myProj.addPbxGroup(frameworkPaths, 'Frameworks', 'Frameworks', null, true, projName);\n    myProj.addBuildPropertyCustom('FRAMEWORK_SEARCH_PATHS', '\"~/Documents/FacebookSDK/**\"');\n    fs.writeFileSync(filename, myProj.writeSync());\n\n    let fileContents = fs.readFileSync(filename, {encoding: 'utf8'})\n    fileContents = addGroup(fileContents, 'Frameworks', groupObj.uuid);\n    fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n\n\n  } else {\n    console.log('Make sure that the iOS project exists and the name in package.json matches the iOS project name');\n  }\n}\n\nfunction editInfoPlist(filename) {\n  if (fs.existsSync(filename)) {\n    let fileContents = fs.readFileSync(filename, {encoding: 'utf8'});\n\n    let fileContentsArr = fileContents.split('\\n');\n    let dictEndLineNumber = 0;\n    fileContentsArr.filter(function (word, index) {\n      if (word.indexOf('</dict>') !== -1) {\n        dictEndLineNumber = index;\n        return true;\n      }\n      return false;\n    });\n\n    fileContentsArr.splice(dictEndLineNumber, 0, `  <key>CFBundleURLTypes</key>\n  <array>\n    <dict>\n      <key>CFBundleURLSchemes</key>\n      <array>\n        <string>__RN_CONFIG_FACEBOOK_APP_URL_SCHEME</string>\n      </array>\n    </dict>\n  </array>\n  <key>FacebookAppID</key>\n  <string>__RN_CONFIG_FACEBOOK_APP_ID</string>\n  <key>FacebookDisplayName</key>\n  <string>__RN_CONFIG_FACEBOOK_APP_NAME</string>\n  <key>LSApplicationQueriesSchemes</key>\n  <array>\n    <string>fbapi</string>\n    <string>fb-messenger-api</string>\n    <string>fbauth2</string>\n    <string>fbshareextension</string>\n  </array>\n  <key>NSPhotoLibraryUsageDescription</key>\n    <string>{human-readable reason for photo access}</string>`);\n\n    fileContents = fileContentsArr.join('\\n');\n    fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n\n  } else {\n    console.log('Make sure that the iOS project exists');\n  }\n}\n\nfunction addHeaderImport(fileContentsArr, importStatement) {\n\n  let lastImportLineNumber = 0;\n  fileContentsArr.filter(function (word, index) {\n    if (word.indexOf('#import') !== -1) {\n      lastImportLineNumber = index;\n      return true;\n    }\n    return false;\n  });\n\n  fileContentsArr.splice(lastImportLineNumber + 1, 0, importStatement);\n\n  return fileContentsArr;\n}\n\nfunction addStatementInFunc(fileContentsArr, funcName, statement) {\n  let funcLineNumber = 0;\n  fileContentsArr.filter(function (word, index) {\n    if (word.indexOf(funcName) !== -1) {\n      funcLineNumber = index;\n      return true;\n    }\n    return false;\n  });\n\n  if(fileContentsArr[funcLineNumber].indexOf('{') !== -1) {\n    fileContentsArr.splice(funcLineNumber + 1, 0, statement);\n  } else {\n    let funcOpenLineNumber = 0;\n    fileContentsArr.filter(function (word, index) {\n      if (word.indexOf('{') !== -1 && index > funcLineNumber && funcOpenLineNumber == 0) {\n        funcOpenLineNumber = index;\n        return true;\n      }\n      return false;\n    });\n\n    fileContentsArr.splice(funcOpenLineNumber + 1, 0, statement);\n  }\n\n\n  return fileContentsArr;\n}\n\nfunction addFuncLast(fileContentsArr, funcDef) {\n  let classEndLineNumber = 0;\n  fileContentsArr.filter(function (word, index) {\n    if (word.indexOf('@end') !== -1) {\n      classEndLineNumber = index;\n      return true;\n    }\n    return false;\n  });\n\n  fileContentsArr.splice(classEndLineNumber, 0, funcDef);\n\n  return fileContentsArr;\n}\n\nfunction editAppDelegate(filename) {\n  if (fs.existsSync(filename)) {\n    let fileContents = fs.readFileSync(filename, {encoding: 'utf8'});\n    let fileContentsArr = fileContents.split('\\n');\n\n    fileContentsArr = addHeaderImport(fileContentsArr, `#import <FBSDKCoreKit/FBSDKCoreKit.h>`);\n    fileContentsArr = addStatementInFunc(fileContentsArr,\n      `(BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions`,\n      `[[FBSDKApplicationDelegate sharedInstance] application:application\n    didFinishLaunchingWithOptions:launchOptions];`);\n\n    fileContentsArr = addFuncLast(fileContentsArr, `\n- (BOOL)application:(UIApplication *)application\n            openURL:(NSURL *)url\n            options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options {\n\n  BOOL handled = [[FBSDKApplicationDelegate sharedInstance] application:application\n    openURL:url\n    sourceApplication:options[UIApplicationOpenURLOptionsSourceApplicationKey]\n    annotation:options[UIApplicationOpenURLOptionsAnnotationKey]\n  ];\n  // Add any custom logic here.\n  return handled;\n}`);\n\n    fileContents = fileContentsArr.join('\\n');\n    fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n  } else {\n    console.log('Make sure that the iOS project exists');\n  }\n}\n\nfunction linkAndroid(filename) {\n  if (fs.existsSync(filename)) {\n    let fileContents = fs.readFileSync(filename, {encoding: 'utf8'}).split('\\n');\n    let lineNumber = 0;\n    fileContents.filter(function (word, index) {\n      if (word.indexOf('apply plugin: \"com.android.application\"') !== -1) {\n        lineNumber = index;\n        return true;\n      }\n      return false;\n    });\n    fileContents.splice(lineNumber + 1, 0, `apply from: project(':react-native-config').projectDir.getPath() + \"/dotenv.gradle\"`);\n\n    fileContents = fileContents.join('\\n');\n    fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n  } else {\n    console.log('Make sure that the Android project exists');\n  }\n}\n\nfunction addToEnv(filename, content) {\n  if (fs.existsSync(filename)) {\n    // let fileContents = fs.readFileSync(filename, {encoding: 'utf8'});\n    //\n    // const lastLinePos = fileContents.lastIndexOf('\\n');\n    // fileContents = [fileContents.slice(0, lastLinePos), content, fileContents.slice(lastLinePos)].join('');\n    //\n    // fs.writeFileSync(filename, fileContents, {encoding: 'utf8'});\n\n    fs.appendFileSync(filename, '\\n' + content + '\\n');\n  } else {\n    console.log('Make sure that .env file exists');\n  }\n}\n\nmodule.exports = generators.Base.extend({\n  constructor: function () {\n    generators.Base.apply(this, arguments);\n  },\n\n  initializing: function () {\n    // const done = this.async();\n\n    this.pkg = this.fs.readJSON(this.destinationPath('package.json'), {});\n    if (!this.pkg || !this.pkg.name) {\n      this.log('Please run this command in the root of a Reazy project');\n      process.exit(1);\n    }\n\n    this.props = {\n      name: this.pkg.name || process.cwd().split(path.sep).pop()\n    };\n\n  },\n\n  prompting: function () {\n    var done = this.async();\n    var prompts = [\n      {\n        name: 'fbAppId',\n        message: 'Facebook App ID',\n        default: '<your-fb-app-id>'\n      },\n      {\n        name: 'fbAppName',\n        message: 'Facebook App name',\n        default: '<your-fb-app-name>'\n      },\n    ];\n\n    this.prompt(prompts).then(function (props) {\n      this.props = assign(this.props, props);\n      done();\n    }.bind(this));\n  },\n\n  downloading: function () {\n    var done = this.async();\n    this.log('\\nDownloading FacebookSDK for iOS. This might take a while.');\n\n    var self = this;\n    downloadFile(\n      'origincache.facebook.com',\n      '/developers/resources/?id=FacebookSDKs-iOS-4.18.0.zip',\n\n      this.templatePath('fbsdk-ios-4.18.0.zip'),\n\n      function (error) {\n        if(error) {\n          console.log('Error: ' + error);\n        } else {\n          console.log('Download complete.\\n');\n          console.log('Unzipping...');\n          extractZip(self.templatePath('fbsdk-ios-4.18.0.zip'), {dir: self.templatePath('fbsdk-ios-4.18.0')}, function (err) {\n            console.log('Unzipping complete\\n');\n            done();\n          })\n        }\n      }\n    );\n  },\n\n  writing: function () {\n    const appJsPath = this.destinationPath('src/app.js');\n    const envPath = this.destinationPath('.env');\n    const iosProjPath = this.destinationPath('ios', this.props.name + '.xcodeproj', 'project.pbxproj');\n    const infoPlistPath = this.destinationPath('ios', this.props.name, 'Info.plist');\n    const appDelegatePath = this.destinationPath('ios', this.props.name, 'AppDelegate.m');\n    const androidBuildGradlePath = this.destinationPath('android/app/build.gradle');\n\n    this.log('Installing react-native-fbsdk as a project dependency...');\n    this.npmInstall(['react-native-fbsdk'], {save: true});\n    this.spawnCommandSync('react-native', ['link', 'react-native-fbsdk']);\n\n    fs.copySync(this.templatePath('fbsdk-ios-4.18.0'), path.join(os.homedir(), 'Documents/FacebookSDK'));\n    editPBXProj(iosProjPath, this.props.name);\n    editInfoPlist(infoPlistPath);\n    editAppDelegate(appDelegatePath);\n    // linkAndroid(androidBuildGradlePath);\n\n    // Automatically import the new service into services/index.js and initialize it.\n    importService(appJsPath, 'authFacebook', 'reazy-native-auth-facebook');\n    useService(appJsPath, `app.use(authFacebook({\n  auth: app.auth,\n}), 'authFacebook');`);\n    addToEnv(envPath, 'FACEBOOK_APP_ID=' + this.props.fbAppId);\n    addToEnv(envPath, 'FACEBOOK_APP_URL_SCHEME=fb' + this.props.fbAppId);\n    addToEnv(envPath, 'FACEBOOK_APP_NAME=' + this.props.fbAppName);\n  }\n});\n"]}